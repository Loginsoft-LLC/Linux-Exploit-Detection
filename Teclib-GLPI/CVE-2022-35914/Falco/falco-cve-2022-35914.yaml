- macro: read_socket
  condition: evt.type=read and (fd.typechar='4' or fd.typechar='6')

- rule: GLPI Remote Code Execution CVE-2022-35914 Exploit Attempted
  desc: Detects Possible execution of system coomand using GLPI CVE-2022-35914
  condition: >
    read_socket and
    evt.dir=< and
    evt.arg.data contains 'POST' and
    evt.arg.data contains '/htmlawed/htmlawed/htmLawedTest.php'
  output: "CVE-2022-35914 exploit attempt detected (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name proc.cwd=%proc.cwd container.id=%container.id evt.arg.data=%evt.arg.data)"
  priority: WARNING
  tags: [host, container, exploit, CVE_2022_35914, glpi, Mitre_Initial_Access, T1190]


- list: shell_binaries
  items: [ash, bash, csh, ksh, sh, tcsh, zsh, dash]

- rule: GLPI Remote Code Execution CVE-2022-35914
  desc: Detects Possible execution of system coomand using GLPI CVE-2022-35914
  condition: >
    evt.dir=< and
    evt.type=execve and
    proc.name in (shell_binaries) and
    proc.pname=apache2 and
    proc.args startswith "-c" and
    proc.cwd contains '/vendor/htmlawed/htmlawed/'
  output: "CVE-2022-35914 exploit attempt detected (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name proc.cwd=%proc.cwd container.id=%container.id)"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2022_35914, glpi, Mitre_Initial_Access, T1190]
