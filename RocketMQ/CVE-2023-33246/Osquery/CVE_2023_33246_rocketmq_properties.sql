SELECT
    target_path,
    category,
    action,
    atime,
    mtime,
    ctime,
    count,
    matches
FROM file_events
JOIN yara
ON yara.path = target_path
AND target_path LIKE '%.properties'
AND count > 0
AND sigrule = '
    rule rocketmq_2023_33246_properties{
        meta:
            author = "Loginsoft Research Team"
            description = "Detect the addition of key in properties file before exploitation."
        strings:
            $key_value_1 = /filterServerNums=(0*[1-9]\d*|0\d{*,})/
            $key_value_2 = "rocketmqHome=-c"
        condition:
            all of them
    }';
