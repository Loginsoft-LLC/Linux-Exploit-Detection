- required_engine_version: 17


#resuing macro #api-manager
- macro: open_write
  condition: (evt.type in (open,openat,openat2) and evt.is_open_write=true and fd.typechar='f' and fd.num>=0)

- macro: check_process_wso2
  condition: (proc.aname[0]=java and (proc.exeline contains org.wso2.carbon.bootstrap) or proc.exeline contains org.wso2.carbon.server)

- rule: WSO2 CVE-2022-29464 Exploit Detection
  desc: Possible CVE-2022-29464 exploit observed. 
  condition: >
    check_process_wso2 and open_write and fd.directory contains /repository/ and fd.nameraw contains '../../../../' and evt.arg.mode=0666 and (fd.filename contains '.jsp' or fd.filename contains '.war' or fd.filename contains '.class')
  output: "CVE-2022-29464 exploit attempt detected (user=%user.name user_loginuid=%user.loginuid command=%proc.cmdline pid=%proc.pid file=%fd.filename directory=%fd.directory container.id=%container.id))"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2022_29464, wso2_apim, wso2_is]

