- required_engine_version: 17

- macro: read_socket
  condition: evt.type=read and (fd.typechar='4' or fd.typechar='6')

- macro: check_process_atlassian_confluence
  condition: (proc.aname[0]=java and proc.name contains http-nio and proc.cmdline contains -DConfluence)


- rule: Atlassian Confluence Server and Data Center Pre-Authorization Arbitrary File Read CVE-2021-26085 
  desc: Possible CVE-2021-26085 Arbitrary File Read Arbitrary File Read vulnerability in the /s/ endpoint exploit Attempt observed. 
  condition: >
    evt.dir=< and 
    read_socket and 
    check_process_atlassian_confluence and 
    evt.arg.data contains GET and evt.arg.data contains '/s/' and evt.arg.data contains '/_/;/'
  output: "CVE-2021-26085 (Atlassian Confluence) exploit detected, Pre-Authorization Arbitrary File Read (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name container.id=%container.id evt.args=%evt.args)"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2021_26085, atlassian_confluence, Mitre_Initial_Access, T1005]
