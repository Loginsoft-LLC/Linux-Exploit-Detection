- required_engine_version: 17

- macro: read_socket
  condition: evt.type=read and (fd.typechar='4' or fd.typechar='6')

- macro: check_process_atlassian_confluence
  condition: (proc.aname[0]=java and proc.name contains http-nio and proc.cmdline contains -DConfluence)

- rule: Atlassian Confluence Server and Data Center hardcoded credentials used CVE-2022-26138 
  desc: Possible CVE-2022-26138 Attempt exploit observed. 
  condition: >
    evt.dir=< and 
    read_socket and 
    check_process_atlassian_confluence and 
    evt.arg.data contains POST and evt.args contains 'os_username=disabledsystemuser&os_password=disabled1system1user6708'
  output: "CVE-2022-26138 (Atlassian Confluence) exploit detected, hardcoded credentials used (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name container.id=%container.id evt.args=%evt.args)"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2022_26138, atlassian_confluence, Mitre_Initial_Access, T0891]


- rule: Atlassian Confluence Server and Data Center hardcoded credentials used CVE-2022-26138 
  desc: Possible CVE-2022-26138 Attempt exploit observed. 
  condition: >
    evt.dir=< and 
    check_process_atlassian_confluence and 
    evt.arg.data contains 'disabledsystemuser' and evt.arg.data contains 'dontdeletethisuser@email.com'
  output: "CVE-2022-26138 (Atlassian Confluence) exploit detected, hardcoded credentials used (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name container.id=%container.id evt.args=%evt.args)"
  priority: WARNING
  tags: [host, container, exploit, CVE_2022_26138, atlassian_confluence, Mitre_Initial_Access, T0891]
