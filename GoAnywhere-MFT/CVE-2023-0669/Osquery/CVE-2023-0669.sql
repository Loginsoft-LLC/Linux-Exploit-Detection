SELECT
    p.name AS process_name,
    p.pid AS process_pid,
    p.cmdline AS process_cmdline,
    p.path AS process_path,
    pof.path AS opened_files,
    yara.count,
    yara.matches
FROM processes p
JOIN process_open_files AS pof
ON p.pid = pof.pid
AND process_name = 'java'
AND process_cmdline LIKE '%bootstrap.GoAnywhereBootstrap%'
AND pof.path LIKE '%/goanywhere.log'
JOIN yara
ON yara.path = pof.path
AND yara.count > 0
AND sigrule = '
    rule goanywhere_2023_0669_log{
        meta:
            author = "Loginsoft Research Team"
            description = "Detect the CVE-2023-0669 exploitation on goanywhere mft"
        strings:
            $parse_error = "Error parsing license response"
            $http_reponse_500 = {41 6e 20 65 72 72 6f 72 20 6f 63 63 75 72 72 65 64 20 77 68 69 6c 65 20 70 72 6f 63 65 73 73 69 6e 67 20 74 68 65 20 72 65 71 75 65 73 74 20 55 52 49 20 27 2f 67 6f 61 6e 79 77 68 65 72 65 2f 6c 69 63 2f 61 63 63 65 70 74 27 20 66 72 6f 6d 20 74 68 65 20 69 70 20 61 64 64 72 65 73 73 20 27 [1-3] 2e [1-3] 2e [1-3] 2e [1-3] 27 2e 20 54 68 65 20 48 54 54 50 20 73 74 61 74 75 73 20 63 6f 64 65 20 69 73 20 27 35 30 30 27}
            $error_class = "at com.linoma.ga.ui.admin.servlet.LicenseResponseServlet.doPost(LicenseResponseServlet.java"
        condition:
            all of them
    }';