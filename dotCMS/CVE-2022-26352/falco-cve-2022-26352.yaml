- required_engine_version: 17

- macro: possibly_java_running_tomcat
  condition: (proc.exe endswith java and proc.cmdline contains org.apache.catalina.startup.Bootstrap)

- macro: dotcms_env
  condition: (proc.env contains DOT_MAIL_SMTP_HOST and proc.env contains DOT_ASSET_REAL_PATH and proc.env contains dotserver/tomcat-)

- rule: DotCMS Unauthenticated Remote Code Execution CVE-2022-26352
  desc: Detects the exploitation of directory traversal which can lead to remote system command execution using DotCMS. Possible exploitation of CVE-2022-26352.
  condition:
    evt.dir=< and
    evt.type=openat and
    evt.arg.name contains '../' and
    dotcms_env and
    possibly_java_running_tomcat
  output: "CVE-2022-26352 exploit attempt detected (user.name=%user.name user.loginuid=%user.loginuid proc.name=%proc.name proc.cwd=%proc.cwd container.id=%container.id evt.arg.name=%evt.arg.name)"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2022_26352, dotCMS, Mitre_Initial_Access, T1190]
