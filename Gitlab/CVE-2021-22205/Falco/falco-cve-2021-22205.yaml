- required_engine_version: 17

- macro: read_socket
  condition: evt.type=read and (fd.typechar='4' or fd.typechar='6')

- rule: Gitlab Unauthenticated Remote Code Execution CVE-2021-22205
  desc: GitLab was not properly validating image files that were passed to a file parser which resulted in a remote code execution.
  condition: >
    evt.dir=<
    and read_socket
    and (evt.arg.data contains '.jpg'
    or evt.arg.data contains '.jpeg'
    or evt.arg.data contains '.tiff')
    and evt.arg.data contains AT&TFORM
    and evt.arg.data contains DJV
    and proc.name=gitlab-workhors
  output: "Possible CVE-2021-22205 exploit attempt (event=%evt.type container_id=%container.id data=%evt.arg.data)"
  priority: CRITICAL
  tags: [host, container, CVE_2021_22205, gitlab, T1210]