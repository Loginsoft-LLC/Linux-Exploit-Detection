package weblogic.cve_2021_2109
import data.tracee.helpers

__rego_metadoc__ := {
  "id": "CVE-2021-2109",
  "version": "0.1.0",
  "name": "weblogic exploit detection",
  "eventName":  "cve_2021_2109_rce",
  "description": "Possible CVE-2021-2109 Attempt exploit attempt observed",
  "tags": ["linux", "container"],
  "properties": {
    "Severity": 3,
    "MITRE ATT&CK": "",
  },
}

eventSelectors := [
  {
    "source": "tracee",
    "name": "net_packet_http",
    "origin": "*",
  },
]

tracee_selected_events[eventSelector] {
  eventSelector := eventSelectors[_]
}

tracee_match  {
  pname := input.processName
  pname == "java" 
  input.eventName == "net_packet_http"
  http_request := helpers.get_tracee_argument("proto_http")
  http_uri_path := http_request.uri_path
  regex.match(`console\/consolejndi\.portal\S+=JNDIBindingPageGeneral\S+JndiBindingHandle\(\S+ldap:\/\/`, http_uri_path)
}

