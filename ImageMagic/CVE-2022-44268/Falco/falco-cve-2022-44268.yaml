- required_engine_version: 17

- macro: memory_map
  condition: evt.type=mmap and evt.dir=>

- rule: Imagemagick Arbitary file read CVE-2022-44268
  desc: ImageMagick is a free and open-source cross-platform software suite for displaying, creating, converting, modifying, and editing raster images and vulnerable to arbitary file read during parsing a crafted PNG file.
  condition: >
    memory_map
    and proc.name=convert
    and evt.arg.fd startswith '<f>'
    and not evt.arg.fd icontains imagemagick
    and not evt.arg.fd contains '.so'
  output: "Possible CVE-2022-44268 exploit attempt (event=%evt.type container_id=%container.id process=%proc.name process_id=%proc.pid data=%evt.info)"
  priority: CRITICAL

  tags: [host, container, exploit, imagemagick, CVE_2022_44268, T1083]
