- required_engine_version: 17

- macro: opentsdb_rce_request
  condition: (evt.arg.data contains 'GET' and 
              evt.arg.data contains '/q?' and 
              evt.arg.data contains '&m=' and 
              evt.arg.data contains 'style' and 
              evt.arg.data contains 'system')


- rule: OpenTSDB Possible Remote Code Execution CVE-2020-35476
  desc: Possible OpenTSDB Remote Code Execution CVE-2020-35476.
  condition: >
    evt.dir=< and 
    proc.env contains opentsdb and
    opentsdb_rce_request
  output: "CVE-2020-35476 (OpenTSDB) Possible Remote Code Execution detected (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name container.id=%container.id evt.args=%evt.args)"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2023_38646, atlassian_confluence, Mitre_Initial_Access, T1190]


- rule: OpenTSDB Possible Remote Code Execution CVE-2020-35476
  desc: Possible OpenTSDB Authentication Bypass CVE-2020-35476.
  condition: >
    evt.dir=< and 
    proc.name icontains OpenTSDB and
    evt.info contains 'set yrange' and 
    evt.info contains ':system('
  output: "CVE-2020-35476 (OpenTSDB) Possible Authentication Bypass detected (user.name=%user.name user.loginuid=%user.loginuid proc.exeline=%proc.exeline proc.name=%proc.name container.id=%container.id evt.args=%evt.args)"
  priority: ALERT
  tags: [host, container, exploit, CVE_2023_38646, atlassian_confluence, Mitre_Initial_Access, T1190]
