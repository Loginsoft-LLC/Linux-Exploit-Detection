- required_engine_version: 17

- macro: read_socket
  condition: evt.type=read and (fd.typechar='4' or fd.typechar='6')

- macro: path_traversal_pattern
  condition: (evt.arg.data contains '%u002e%u002e' or evt.arg.data contains '%c0%2e%c0%2e' or evt.arg.data contains '%e0%40%ae%e0%40%ae' or evt.arg.data contains '%c0ae%c0ae' or evt.arg.data contains '%25%2e%25%2e' or evt.arg.data contains '%2e%2e' or evt.arg.data contains '../../')

- rule: Opnefire Administration Console Authentication Bypass for either CVE-2008-6508 or CVE-2023-32315
  desc: Detects path traversal vulnerability used to bypass authentication. Possible Exploitation of CVE-2023-32315.
  condition: >
    evt.dir=< and
    read_socket and
    evt.arg.data contains '/setup/setup-s/' and
    path_traversal_pattern and
    proc.cmdline contains '-DopenfireHome' and 
    proc.aname[0]=java
  output: "CVE-2008-6508 or CVE-2023-32315 Administration Console Authentication Bypass detected (event=%evt.type server_ip=%fd.sip server_port=%fd.sport proto=%fd.l4proto fd.cip=%fd.cip user.name=%user.name user.loginuid=%user.loginuid parent=%proc.pname process=%proc.name container_id=%container.id)"
  priority: CRITICAL
  tags: [host, container, exploit, CVE_2023_32315, openfire, path_traversal]
